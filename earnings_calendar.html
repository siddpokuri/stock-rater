<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming Earnings Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header-container {
            @apply bg-white shadow-md py-4 px-6 flex flex-col items-center; /* Changed to flex-col for stacking */
        }
        .back-button {
            @apply bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 ease-in-out;
            @apply mt-4; /* Add top margin to separate from title */
        }
        .earnings-card {
            @apply bg-white p-6 rounded-xl shadow-md flex flex-col space-y-2;
        }
        .earnings-card strong {
            @apply text-gray-700;
        }
        .earnings-card span {
            @apply text-gray-800;
        }
        .link-text {
            @apply text-blue-600 hover:underline font-medium;
        }
        .no-data-message {
            @apply text-center text-gray-500 text-lg py-10;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6; /* Tailwind blue-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Removed #dateRangeDisplay styling as it's being removed from HTML */
    </style>
</head>
<body class="bg-gray-100">
    <header class="header-container">
        <h1 class="text-3xl font-bold text-gray-800 text-center">Upcoming Earnings Calendar</h1>
        <!-- Back button moved directly below the title -->
        <a href="index.html" class="back-button">‚Üê Back to Home</a>
    </header>

    <main class="container mx-auto p-6 flex-grow">
        <div id="loadingIndicator" class="text-center text-gray-600 text-lg mt-10 hidden">
            <div class="loading-spinner"></div> Loading Earnings Data...
        </div>

        <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl relative mt-10" role="alert">
            <strong class="font-bold">Error!</strong>
            <span class="block sm:inline" id="errorText"></span>
        </div>

        <div id="calendarContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
            <!-- Earnings cards will be populated here -->
        </div>
        <p id="noCalendarDataMessage" class="no-data-message hidden"></p>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calendarContentDiv = document.getElementById('calendarContent');
            const noCalendarDataMessage = document.getElementById('noCalendarDataMessage');
            // Removed dateRangeDisplay element reference

            // Retrieve data from sessionStorage
            const storedData = sessionStorage.getItem('upcomingEarningsData');
            const fromDate = sessionStorage.getItem('upcomingEarningsFromDate'); // Still retrieve for no data message
            const toDate = sessionStorage.getItem('upcomingEarningsToDate');     // Still retrieve for no data message

            if (storedData) {
                const data = JSON.parse(storedData);
                if (data.length > 0) {
                    displayCalendarData(data);
                } else {
                    noCalendarDataMessage.textContent = `No upcoming earnings found from ${fromDate} to ${toDate}.`;
                    noCalendarDataMessage.classList.remove('hidden');
                }
                // Clear sessionStorage after use to prevent stale data on direct access
                sessionStorage.removeItem('upcomingEarningsData');
                sessionStorage.removeItem('upcomingEarningsFromDate');
                sessionStorage.removeItem('upcomingEarningsToDate');
            } else {
                // This case should ideally not happen if index.html handles navigation correctly
                noCalendarDataMessage.textContent = 'No earnings data available. Please select dates from the home page.';
                noCalendarDataMessage.classList.remove('hidden');
            }
        });

        function displayCalendarData(data) {
            const calendarContentDiv = document.getElementById('calendarContent');
            calendarContentDiv.innerHTML = ''; // Clear previous content

            // Sort data by Release Date
            data.sort((a, b) => {
                const dateA = new Date(a["Release Date"]);
                const dateB = new Date(b["Release Date"]);
                return dateA - dateB;
            });

            data.forEach(entry => {
                const card = document.createElement('div');
                card.className = 'earnings-card bg-white p-6 rounded-xl shadow-md flex flex-col space-y-2'; 
                card.innerHTML = `
                    <p><strong>Symbol:</strong> <span>${entry["Symbol"] || 'N/A'}</span></p>
                    <p><strong>Exchange:</strong> <span>${entry["Exchange Name"] || 'N/A'}</span></p>
                    <p><strong>Release Date:</strong> <span>${entry["Release Date"] || 'N/A'}</span></p>
                    <p><strong>Time:</strong> <span>${entry["Time"] || 'N/A'}</span></p>
                    <p><strong>When:</strong> <span>${entry["When"] || 'N/A'}</span></p>
                    <p><strong>Published Date:</strong> <span>${entry["Published Date"] || 'N/A'}</span></p>
                    <p>
                        <strong>More Info:</strong> 
                        <span>
                            ${entry["More Info"] && entry["More Info"] !== 'N/A' ? `<a href="${entry["More Info"]}" target="_blank" rel="noopener noreferrer" class="link-text">Link: More Info</a>` : 'N/A'}
                        </span>
                    </p>
                `;
                calendarContentDiv.appendChild(card);
            });
        }

        // Helper functions (showLoading, showError) are not strictly needed on this page
        // as the data is passed via sessionStorage and errors are handled on index.html
        // However, keeping them as placeholders if future direct fetches are added.
        function showLoading(show) {
            document.getElementById('loadingIndicator').classList.toggle('hidden', !show);
        }

        function showError(message) {
            const errorMessageDiv = document.getElementById('errorMessage');
            const errorTextSpan = document.getElementById('errorText');
            errorTextSpan.textContent = message;
            errorMessageDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>
